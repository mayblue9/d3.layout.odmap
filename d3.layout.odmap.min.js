d3.layout.odmap=function(a){function t(){}if(typeof nmap!=typeof Function)throw"ERROR: You need to include the nmap.js library.";var i=[],d={s:{x:"x",y:"y",id:"id",title:"id",hx:"hx",hy:"hy",hwidth:"hwidth",hheight:"hheight"},nmap:{cut:"alternate",method:"border",square:!0,border_adv:1},hand:!1,width:300,height:300},h=nmap_extend(d,a);t();var e,n,m,r,s,o,g,u,x,l="",f={min:Number.MAX_VALUE,max:-Number.MAX_VALUE,imin:Number.MAX_VALUE,imax:-Number.MAX_VALUE,smin:Number.MAX_VALUE,smax:-Number.MAX_VALUE,ismin:Number.MAX_VALUE,ismax:-Number.MAX_VALUE},p,w,y,A;return t.data=function(a){var t=-Number.MAX_VALUE,d=Number.MAX_VALUE,x=-Number.MAX_VALUE,l=Number.MAX_VALUE,b=-Number.MAX_VALUE,_=Number.MAX_VALUE,M=-Number.MAX_VALUE,c=Number.MAX_VALUE,E,v,L,N,U,V,X,F;for(g=0;g<a.length;g++)E=parseFloat(a[g].x),v=parseFloat(a[g].y),E>t&&(t=E),d>E&&(d=E),v>x&&(x=v),l>v&&(l=v),h.hand&&(L=parseFloat(a[g][h.s.hx]),N=parseFloat(a[g][h.s.hy]),U=parseFloat(a[g][h.s.hwidth]),V=parseFloat(a[g][h.s.hheight]),L+U>b&&(b=L),_>L&&(_=L),N+V>M&&(M=N),c>N&&(c=N));for(e=t-d,n=x-l,s=h.width/e,o=h.height/n,o>s?o=s:s=o,m=e*s,r=n*o,h.hand&&(U=b,V=M,X=m/U,F=r/V),y=A=Math.ceil(Math.sqrt(a.length)),p=m/A,w=r/y,g=0;g<a.length;g++){var D={id:a[g][h.s.id],title:a[g][h.s.title],x:(parseFloat(a[g][h.s.x])-d)*s,y:(parseFloat(a[g][h.s.y])-l)*o,ox:a[g][h.s.x],oy:a[g][h.s.y],h:{x:0,y:0,width:0,height:0},g:{x:(g-Math.floor(g/A)*A)*p,y:Math.floor(g/y)*w,width:p,height:w},data:{min:Number.MAX_VALUE,max:-Number.MAX_VALUE,data:[]},idata:{min:Number.MAX_VALUE,max:-Number.MAX_VALUE,data:[]},n:{x:0,y:0,width:0,height:0}};h.hand&&(D.h.x=(parseFloat(a[g][h.s.hx])-_)*X,D.h.y=(parseFloat(a[g][h.s.hy])-c)*F,D.h.width=parseFloat(a[g][h.s.hwidth])*X,D.h.height=parseFloat(a[g][h.s.hheight])*F);var q,k;for(u=0;u<a.length;u++)q=parseFloat(a[u][D.id]),k={amount:q,x:0,y:0,width:0,height:0,id:a[u][h.s.id]},D.data.data.push(k),q>D.data.max&&(D.data.max=q),q<D.data.min&&(D.data.min=q),q>f.max&&(f.max=a[u][D.id]),q<f.min&&(f.min=a[u][D.id]),g!==u&&(q>f.smax&&(f.smax=a[u][D.id]),q<f.smin&&(f.smin=a[u][D.id]));for(u=0;u<a.length;u++)q=parseFloat(a[g][a[u][h.s.id]]),k={amount:q,x:0,y:0,width:0,height:0,id:a[u][h.s.id]},D.idata.data.push(k),q>D.idata.max&&(D.idata.max=q),q<D.idata.min&&(D.idata.min=q),q>f.imax&&(f.imax=a[u][D.id]),q<f.imin&&(f.imin=a[u][D.id]),g!==u&&(q>f.ismax&&(f.ismax=a[u][D.id]),q<f.ismin&&(f.ismin=a[u][D.id]));i.push(D)}var R=nmap_squared({width:h.width,height:h.height,data:i,method:h.nmap.method,square:h.nmap.square,border_adv:h.nmap.border_adv}),j=[];for(g=0;g<R.data.length;g++)j.push(new nmap_element({id:R.data[g].id,x:R.data[g].x,y:R.data[g].y,weight:1e4+Math.random(),klass:R.data[g]["class"]}));var C=new nmap({x:0,y:0,width:R.width,height:R.height}),O;for(O="alternate"===h.nmap.cut?C.alternateCut({elements:j}):C.equalWeight({elements:j}),u=0;u<i.length;u++)for(g=0;g<O.length;g++)O[g].attr().element.attr().id===i[u].id&&(i[u].n.x=O[g].attr().x,i[u].n.y=O[g].attr().y,i[u].n.width=O[g].attr().width,i[u].n.height=O[g].attr().height)},t.toggle=function(){l=""===l?"i":""},t.switchTo=function(a){l=a},t.geo=function(a){var d={min:f[l+"min"],max:f[l+"max"],smin:f[l+"smin"],smax:f[l+"smax"],width:m,height:r,data:[]};for(g=0;g<i.length;g++)d.data.push({x:i[g].x,y:i[g].y,width:i[g].g.width,height:i[g].g.height,id:i[g].id,data:i[g][l+"data"]});return"undefined"==typeof a?d:t.setData(d,a)},t.nmap=function(a){var d={min:f[l+"min"],max:f[l+"max"],smin:f[l+"smin"],smax:f[l+"smax"],width:m,height:r,data:[]};for(g=0;g<i.length;g++)d.data.push({x:i[g].n.x,y:i[g].n.y,width:i[g].n.width,height:i[g].n.height,id:i[g].id,data:i[g][l+"data"]});return"undefined"==typeof a?d:t.setData(d,a)},t.hand=function(a){var d={min:f[l+"min"],max:f[l+"max"],smin:f[l+"smin"],smax:f[l+"smax"],width:m,height:r,data:[]};for(g=0;g<i.length;g++)d.data.push({x:i[g].h.x,y:i[g].h.y,width:i[g].h.width,height:i[g].h.height,id:i[g].id,data:i[g][l+"data"]});return"undefined"==typeof a?d:t.setData(d,a)},t.matrix=function(a){var d={min:f[l+"min"],max:f[l+"max"],smin:f[l+"smin"],smax:f[l+"smax"],width:h.width,height:h.height,data:[]};if("undefined"==typeof a)for(g=0;g<i.length;g++)d.data.push({x:g*h.width/i.length,y:0,width:h.width/i.length,height:h.height,id:i[g].id,data:i[g][l+"data"]});else for(g=0;g<i.length;g++)d.data.push({x:0,y:g*h.height/i.length,width:h.width,height:h.height/i.length,id:i[g].id,data:i[g][l+"data"]});return"undefined"==typeof a?d:t.setData(d,a)},t.sankey=function(){var a={nodes:[],links:[]};for(g=0;g<i.length;g++)a.nodes.push({name:i[g].id});for(g=0;g<i[0][l+"data"].data.length;g++)a.nodes.push({name:i[g].id});for(g=0;g<i.length;g++)for(u=0;u<i[g][l+"data"].data.length;u++)a.links.push({source:g,target:u+i.length,value:i[g][l+"data"].data[u].amount});return a},t.bipartite=function(){var a=[];for(g=0;g<i.length;g++)for(u=0;u<i[g][l+"data"].data.length;u++)a.push([i[g].id,i[g][l+"data"].data[u].id,i[g][l+"data"].data[u].amount]);return a},t.list=function(a){var d={min:f[l+"min"],max:f[l+"max"],smin:f[l+"smin"],smax:f[l+"smax"],width:m,height:r,data:[]};for(g=0;g<i.length;g++)d.data.push({x:0,y:h.height/i.length*g,width:h.width,height:h.height/i.length,id:i[g].id,data:i[g][l+"data"]});return"undefined"==typeof a?d:t.setData(d,a)},t.grid=function(a){var d={min:f[l+"min"],max:f[l+"max"],smin:f[l+"smin"],smax:f[l+"smax"],width:m,height:r,data:[]};for(g=0;g<i.length;g++)d.data.push({x:i[g].g.x,y:i[g].g.y,width:i[g].g.width,height:i[g].g.height,id:i[g].id,data:i[g][l+"data"]});return"undefined"==typeof a?d:t.setData(d,a)},t.setData=function(a,t){var i=[];for(x=0;x<t.data.length;x++)i[t.data[x].id]=x;for(g=0;g<a.data.length;g++)for(u=0;u<a.data[g].data.data.length;u++)for(x=0;x<t.data.length;x++)a.data[g].data.data[u].x=t.data[i[a.data[g].data.data[u].id]].x,a.data[g].data.data[u].y=t.data[i[a.data[g].data.data[u].id]].y,a.data[g].data.data[u].width=t.data[i[a.data[g].data.data[u].id]].width,a.data[g].data.data[u].height=t.data[i[a.data[g].data.data[u].id]].height;return a},t};